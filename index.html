<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å¤¢æƒ³æ©Ÿ è¨ºæ–·æ¨¡å¼</title>
    <style>
        body { font-family: sans-serif; padding: 20px; text-align: center; }
        #app-content { display: none; border: 2px solid #4A90E2; padding: 20px; border-radius: 10px; }
        .data-box { font-size: 24px; color: #4A90E2; font-weight: bold; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ğŸš€ å¤¢æƒ³æ©Ÿ é€£ç·šæ¸¬è©¦</h1>
    
    <div id="login-box">
        <p>è«‹è¼¸å…¥é©—è­‰ç¢¼ (ç›®å‰è¨­å®š: 1234)</p>
        <input type="password" id="pin-input" style="font-size:20px; width:100px; text-align:center;">
        <button onclick="testConnection()" style="font-size:20px;">ç¢ºèªç™»å…¥</button>
    </div>

    <div id="app-content">
        <div class="data-box">æš±ç¨±ï¼š<span id="show-name">--</span></div>
        <div class="data-box">å€’æ•¸ï¼š<span id="show-days">--</span> å¤©</div>
        <p style="color: green;">âœ… é€£ç·šæˆåŠŸï¼æ‚¨çš„è³‡æ–™å·²æ­£ç¢ºç”± Google å‚³å›ã€‚</p>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const SHEET_ID = urlParams.get('id');
        // é€™æ˜¯æ‚¨æ¸¬è©¦æˆåŠŸçš„ API ç¶²å€
        const API_URL = "https://script.google.com/macros/s/AKfycbwEA2bbL94YtNbunJj_Dej5UidtvExIKm28tctKsdEOUIuIdfBpNkHGCr0WXQLQzBVYew/exec";

        async function testConnection() {
            const pin = document.getElementById('pin-input').value;
            alert("æ­£åœ¨å˜—è©¦æŠ“å–è³‡æ–™ï¼Œè«‹ç¨å€™...");

            try {
                const res = await fetch(`${API_URL}?action=getSummary&id=${SHEET_ID}&pin=${pin}`);
                const json = await res.json();
                
                console.log("æ”¶åˆ°è³‡æ–™:", json);

                if (json.status === "success") {
                    // å¼·åˆ¶å¡«å…¥è³‡æ–™
                    document.getElementById('show-name').innerText = json.data.nickname;
                    document.getElementById('show-days').innerText = json.data.remainingDays;
                    
                    // å¼·åˆ¶åˆ‡æ›ç•«é¢
                    document.getElementById('login-box').style.display = 'none';
                    document.getElementById('app-content').style.display = 'block';
                    
                    alert("ğŸ‰ æˆåŠŸï¼æŠ“åˆ°æš±ç¨±ï¼š" + json.data.nickname);
                } else {
                    alert("âŒ é©—è­‰å¤±æ•—ï¼š" + json.message);
                }
            } catch (e) {
                alert("âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š" + e.message);
            }
        }
    </script>
</body>
</html>